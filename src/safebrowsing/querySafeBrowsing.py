from urllib2 import Request, urlopen, URLError, HTTPError
import requests

class SafeBrowsing:
	def __init__(self, urlPerPost=500):
		self.urlPerPost = 500

	# The safebrowsing v2 is not implemented here.

	# This is an example GET request for the lookup API:
	def getReq(self, lookupurl):
		url = "https://sb-ssl.google.com/safebrowsing/api/lookup?client=api&apikey=ABQIAAAAByTIeu_ibQahWWvoHB3rChT1i2MeTIrZeMvk-RNEUyMjIzvYvw&appver=1.0&pver=3.0&url=http%3A%2F%2Fianfette.org%2F"
		req = Request(url)
		try:
			f = urlopen(req)
		except URLError, e:
			print e.code
			print e.read()
		print f.read()

	# This is an example POST request for the lookup API:
	def postReq(self, lookupurls):
		url = "https://sb-ssl.google.com/safebrowsing/api/lookup?client=api&apikey=ABQIAAAAByTIeu_ibQahWWvoHB3rChT1i2MeTIrZeMvk-RNEUyMjIzvYvw&appver=1.0&pver=3.0"
		data = "{0}\n{1}".format(len(lookupurls), "\n".join(lookupurls))
		response = requests.post(url, data)
		return response 

	def postReqFile(self, infile, outfile):
		inf = open(infile, 'r')
		outf = open(outfile, 'w')
		lookupurls = list()
		counter = 0
		for line in inf:
			counter = counter + 1
			if counter == 500:
				counter = 0


if __name__=="__main__":
	sb = SafeBrowsing()
	urls = ["http://www.google.com/", "http://ianfette.org/"]
	response = sb.postReq(urls)
	print response.text
	print response.status_code

