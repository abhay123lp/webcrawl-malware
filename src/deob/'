from psqloperation import PsqlCon
import chromeDeob
import jsbeautify
import rmcomment
import chunkJS
import malurl
import utils


def deobLink(url, jscommentname, jsname, chunkoutdir, beautifydir):
	chromeDeob.chromeDeobLink(url, jscommentname)
	rmcomment.rmCommentFile(jscommentname, jsname)
	chunkJS.chunkJSFile(jsname, chunkoutdir)
	jsbeautify.jsdeobfuscatedir(chunkoutdir, beautifydir)


def deobFile(filename):
	thefile = open(filename, 'r')
	for line in thefile:
		paras = utils.genTempnameLine(line)
		deobLink(paras[0], paras[1], paras[2], paras[3], paras[4])


def deobLabel(label):
	con = PsqlCon()
	res = con.psqlSelectOneLabel('TEST')
	for url, url_hash, label in res:
		paras = utils.genTempnameTuple(url, url_hash, label)
		deobLink(paras[0], paras[1], paras[2], paras[3], paras[4])


def deobTerry():
	malurl.formatJSTerry('../../data/JSTerry/javascript_20131018/jsterry')
	jsbeautify.deobJSTerry()


if __name__=='__main__':
	'''
	con = PsqlCon()
	print con.psqlSelectOneLabel('TEST')
	deobLabel('TEST')
	
	# Store the related information into 
	# con.psqlReadURLHashFromFile('../../data/TempData/URLs/alexaustop')
	'''
	deobFile('../../data/TempData/URLs/alexaustop')
