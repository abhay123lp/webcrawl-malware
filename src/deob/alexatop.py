from selenium.common.exceptions import NoSuchElementException
from selenium.common.exceptions import TimeoutException
from selenium.webdriver.common.keys import Keys
from selenium import webdriver
import hashlib
import urllib
import urllib2
import locale
import codecs
import time
import sys
import re

'''
Get the benign list of websites. Including top 500 of global/US websites.
'''

locale.setlocale( locale.LC_ALL, 'en_US.UTF-8' ) 
# use selenium to visit the page
profile = webdriver.FirefoxProfile()
browser = webdriver.Firefox(profile) # Get local session of firefox
browser.delete_all_cookies()

globaltop = '../../data/TempData/URLs/alexaglobaltop'
ustop = '../../data/TempData/URLs/alexaustop'

globaltop = codecs.open(globaltop, encoding = 'utf-8', mode = 'w')
ustop = codecs.open(ustop, encoding = 'utf-8', mode = 'w')

urlp1 = "http://www.alexa.com/"
urlp2 = "topsites/global;"
total = 500
perpage = 25
upperbound = total/perpage

pages = []
first = True

for i in range(0, upperbound):
	pages.append(str(i))
for urlp3 in pages:
	url = urlp1 + urlp2 + urlp3
	browser.get(url)
	site_listing = browser.find_elements_by_class_name("site-listing")
	for website in site_listing:
		name = website.find_element_by_tag_name("h2").find_element_by_tag_name("a").text
		link = website.find_element_by_class_name("topsites-label").text
		domain = link
		label = 'B1'
		real_type = 'Benign'
		#globaltop.write(name + '\n' + link + '\n\n')
		hex_hash = hashlib.sha256(link).hexdigest()
		if first:
			first = False
			globaltop.write('(\'' + hex_hash + '\',\'' + link + '\',\'' + domain + '\',\'' + label + '\',\'' + real_type + '\')')
		else:
			globaltop.write(',\n(\'' + hex_hash + '\',\'' + link + '\',\'' + domain + '\',\'' + label + '\',\'' + real_type + '\')')



urlp2 = "topsites/countries;"
pages = []
first = True

for i in range(0, upperbound):
	pages.append(str(i))
urlp4 = "/US"
for urlp3 in pages:
	url = urlp1 + urlp2 + urlp3 + urlp4
	browser.get(url)
	site_listing = browser.find_elements_by_class_name("site-listing")
	for website in site_listing:
		name = website.find_element_by_tag_name("h2").find_element_by_tag_name("a").text
		link = website.find_element_by_class_name("topsites-label").text
		domain = link
		label = 'B1'
		real_type = 'Benign'
		#ustop.write(name + '\n' + link + '\n\n')
		hex_hash = hashlib.sha256(link).hexdigest()
		if first:
			first = False
			ustop.write('(\'' + hex_hash + '\',\'' + link + '\',\'' + domain + '\',\'' + label + '\',\'' + real_type + '\')')
		else:
			ustop.write(',\n(\'' + hex_hash + '\',\'' + link + '\',\'' + domain + '\',\'' + label + '\',\'' + real_type + '\')')


browser.close()

