(function() {
  var csiStart = (+new Date);
  var DEBUG = ''.toLowerCase() == 'true';
  var studioObjects = window['studioV2'] = window['studioV2'] || {};
  var publisherSideFilePath = '';
  if(publisherSideFilePath == '') {
    publisherSideFilePath = '/doubleclick/DARTIframe.html';
  } else if (publisherSideFilePath.charAt(publisherSideFilePath.length - 1) == '/') {
    publisherSideFilePath += 'DARTIframe.html';
  }
  var bookingTimeMetaData = {
  };
  var runtimeMetaData = {
  };
  var exitUrlPatternMacroValues = {
  };
  var macroParser = function (macroName, value) {
    return (value.indexOf(macroName) < 0) ? value : '';
  };
  var adServerData = {
    eventReportingUrl: 'http://ad.doubleclick.net/activity;src=1330903;met=1;v=1;pid=104041149;aid=276810116;ko=0;cid=56115951;rid=56005265;rv=1;',
    clickUrl: 'http://adclick.g.doubleclick.net/aclk?sa=L&ai=B8oeNrwdfUp3dDZG-6gHi3IGAA62Svu8FAAAAEAEgADgAWK3U5u9_YMm-uYfgo7QQggEXY2EtcHViLTI2MTQ2NjYyNjE1Nzk3NDGyAQ93d3cueW91dHViZS5jb226AQlnZnBfaW1hZ2XIAQnaARdodHRwOi8vd3d3LnlvdXR1YmUuY29tL8ACAuACAOoCGDQwNjEvY29tLnl0aG9tZS9fZGVmYXVsdPgChNIegAMBkAPgA5gD4AOoAwHgBAGgBh4&num=0&sig=AOD64_1W8sWZt7TTv-nE2ufmEpGanJtO5Q&client=ca-pub-2614666261579741&adurl=http%3A%2F%2Fad.doubleclick.net/click%3Bh%3Dv8/3e7d/3/0/%2a/u%3B276810116%3B0-0%3B0%3B104041149%3B29972-970/250%3B56115951/56005265/1%3B%3B%7Eokv%3D%3Bpc%3D%5BTPAS_ID%5D%3B%3B%7Esscs%3D%3f',
    clickUrlTimesToEscape: '',
    impressionUrl: 'http%3A//ad.doubleclick.net/imp%3Bv7%3Bx%3B276810116%3B0-0%3B0%3B104041149%3B970%2F250%3B56115951%2F56005265%2F1%3B%3B%7Eokv%3D%3Bpc%3D%5BTPAS_ID%5D%3B%3B%7Ecs%3Dr%3f',
    geoData: 'ct=US&st=GA&ac=404&zp=30309&bw=4&dma=26&city=13241',
    siteName: 'N1558.127733.6865139611621',
    siteId: '887140',
    adId: '276810116',
    buyId: '7882057',
    creativeId: '56115951',
    placementId: '104041149',
    advertiserId: '1330903',
    keyValueOrdinal: '0',
    renderingVersion: '1',
    renderingId: '56005265',
    randomNumber: '27855',
    dynamicData: '',
    stringReportingUrl: 'http://ad.doubleclick.net/activity;src=1330903;stragg=1;v=1;pid=104041149;aid=276810116;ko=0;cid=56115951;rid=56005265;rv=1;rn=27855;',
    urlToGetKeywordsFor: '%LivePreviewSiteUrl',
    bookingTimeMetaData: bookingTimeMetaData,
    exitSuffix: macroParser('exit_suffix', '%exit_suffix!'),
    generatedAdSlot: false,
    exitUrlPatternMacroValues: exitUrlPatternMacroValues,
    activeViewClkStr: macroParser('eav', '%eav!'),
    tag: {
      adContainerElementId: macroParser('ad_container_id', ''),
      hideObjects: '',
      top: '',
      left: '',
      zIndex: '',
      duration: '',
      wmode: '',
      preferHtml5Artwork: '' == 'true',
      adSenseKeywords: '',
      adSenseLatitude: '',
      adSenseLongitude: '',
      publisherSideFilePath: publisherSideFilePath,
      runtimeMetaData: runtimeMetaData,
      lidarEnabled: false,
      expansionMode: '',
      renderFloatInplace: ''.toLowerCase() == 'true'
    }
  };
  var mediaServer = location.protocol == 'https:' ?
       'https://s0.2mdn.net' :
       'http://s0.2mdn.net';
  var backupImageUrl = '/ads/richmedia/studio/5204536/24287466_20131010075832146_rollergirl_970x250 backup.jpg';
  if (!/^https?:/.test(backupImageUrl)) {
    backupImageUrl = mediaServer + backupImageUrl;
  }
  var backupImage = {
    exitUrl: 'http://adclick.g.doubleclick.net/aclk?sa=L&ai=B8oeNrwdfUp3dDZG-6gHi3IGAA62Svu8FAAAAEAEgADgAWK3U5u9_YMm-uYfgo7QQggEXY2EtcHViLTI2MTQ2NjYyNjE1Nzk3NDGyAQ93d3cueW91dHViZS5jb226AQlnZnBfaW1hZ2XIAQnaARdodHRwOi8vd3d3LnlvdXR1YmUuY29tL8ACAuACAOoCGDQwNjEvY29tLnl0aG9tZS9fZGVmYXVsdPgChNIegAMBkAPgA5gD4AOoAwHgBAGgBh4&num=0&sig=AOD64_1W8sWZt7TTv-nE2ufmEpGanJtO5Q&client=ca-pub-2614666261579741&adurl=http%3A%2F%2Fad.doubleclick.net/activity;src%3D1330903%3Bmet%3D1%3Bv%3D1%3Bpid%3D104041149%3Baid%3D276810116%3Bko%3D0%3Bcid%3D56115951%3Brid%3D56005265%3Brv%3D1%3Bcs%3Dz%3Beid1%3D1317721%3Becn1%3D1%3Betm1%3D0%3B_dc_redir%3Durl%3fhttp://ad.doubleclick.net/click%3Bh%3Dv8/3e7d/3/0/%2a/u%3B276810116%3B0-0%3B0%3B104041149%3B29972-970/250%3B56115951/56005265/1%3B%3B%7Eokv%3D%3Bpc%3D%5BTPAS_ID%5D%3B%3B%7Esscs%3D%3fhttp://www.capitalone.com/findmycard?external_id\x3dWWW_HI_BNUSCD_PQ_YTB_ROL_AS_OT9X2_BAN2',
    target: '_blank',
    imageUrl: backupImageUrl,
    width: '970',
    height: '250',
    backupDisplayActivityUrl: [
      adServerData.eventReportingUrl,
      '&timestamp=', (+new Date), ';',
      'eid1=9;ecn1=1;etm1=0;'].join(''),
    thirdPartyBackupImpressionUrl: ''
  };
  var versionPrefix = DEBUG ? 'db_' : '';
  var templateVersion = '200_30';
  var renderingScriptPath = '/879366';
  var rendererDisplayType = '';
  rendererDisplayType += 'flash_';
  var rendererFormat = 'inpage';
  var rendererName = rendererDisplayType + rendererFormat;
  var renderingLibrary = renderingScriptPath + '/' + rendererName + '_rendering_lib_' +
      versionPrefix + templateVersion + '.js';
  if (!/^https?:/.test(renderingLibrary)) {
    renderingLibrary = mediaServer + renderingLibrary;
  }
  var adCreativeDefinitions = {};
  var creativeId = '1381527106166';
  var adId = adCreativeDefinitions[adServerData.adId] ? adServerData.adId : 0;
  var creativeKey = [creativeId, adId].join('_');
  var creativeDef = adCreativeDefinitions[adServerData.adId] ?
      adCreativeDefinitions[adServerData.adId] :
      'http://s0.2mdn.net/1330903/plcr_2743928_0_1381527106262.js';
  if(!/^https?:/.test(creativeDef)) {
    creativeDef = mediaServer + creativeDef;
  }
  studioObjects['creativeCount'] = studioObjects['creativeCount'] || 0;
  var creativeDto = {
    id: creativeId,
    uniqueId: creativeId + '_' + studioObjects['creativeCount']++,
    templateVersion: templateVersion,
    adServerData: adServerData,
    isPreviewEnvironment: '%PreviewMode' == 'true',
    hasFlashAsset: true,
    hasHtmlAsset: false,
    flashVersion: '10',
    httpsMediaServer: 'https://s0.2mdn.net',
    httpMediaServer: 'http://s0.2mdn.net',
    renderingScriptPath: renderingScriptPath,
    renderingLibrary: renderingLibrary,
    rendererName: rendererName,
    creativeDefinitionUrl: creativeDef,
    creativeKey: creativeKey,
    thirdPartyImpressionUrls: [''],
    thirdPartyArtworkImpressionUrl: '',
    breakoutToTop: false,
    dimensions: {
      width: '970px',
      height: '250px'
    },
    csiStart: csiStart,
    csiAdRespTime: csiStart - (parseFloat('') || 0),
    csiEvents: {}
  };
  var inGdnIframe = window['IN_ADSENSE_IFRAME'] || false;
  var inYahooSecureIframe = window.Y && Y.SandBox && Y.SandBox.vendor;
  var inWinLiveIframe = false;
  try {
    inWinLiveIframe = !!window.$WLXRmAd;
  } catch(e) {}
  var inSafeFrame = window.$sf && window.$sf.ext;
  var isMsnAjaxIframe = (typeof(inDapMgrIf) != 'undefined' && inDapMgrIf);
  var inStudioPreviewIframe = creativeDto.isPreviewEnvironment && !window.iframeRequest;
  var breakoutInpage = ''.toLowerCase() == 'true';
  var allowBreakout = ''.toLowerCase() != 'false';
  var shouldBreakout = (((false ||
                          false) &&
                         !inGdnIframe &&
                         !inYahooSecureIframe &&
                         !inSafeFrame &&
                         !inWinLiveIframe &&
                         allowBreakout) ||
                        (true && breakoutInpage)) &&
                       self != top &&
                       !inStudioPreviewIframe;
  if (adServerData.tag.adContainerElementId == '' &&
      (true || false ||
         adServerData.tag.renderFloatInplace)) {
    var containerId = ['creative', creativeDto.uniqueId].join('_');
    var divHtml = ['<div id="', containerId, '"></div>'].join('');
    document.write(divHtml);
    adServerData.tag.adContainerElementId = containerId;
    adServerData.generatedAdSlot = true;
  }
  var creatives = studioObjects['creatives'] = studioObjects['creatives'] || {};
  var creative = creatives[creativeKey] = creatives[creativeKey] || {};
  var adResponses = creative['adResponses'] = creative['adResponses'] || [];
  creative['shouldBreakout'] = creative['shouldBreakout'] || shouldBreakout;
  var iframeBusterLibrary = renderingScriptPath + '/iframe_buster_' +
      versionPrefix + templateVersion + '.js';
  if(!/^https?:/.test(iframeBusterLibrary)) {
    iframeBusterLibrary = mediaServer + iframeBusterLibrary;
  }
  var loadedLibraries = studioObjects['loadedLibraries'] = studioObjects['loadedLibraries'] || {};
  var versionedLibrary = loadedLibraries[templateVersion] = loadedLibraries[templateVersion] || {};
  var typedLibrary = versionedLibrary[rendererName] = versionedLibrary[rendererName] || {};
  adResponses.push({
    creativeDto: creativeDto,
    backupImage: backupImage
  });
  if (shouldBreakout) {
    if (versionedLibrary['breakout']) {
      versionedLibrary['breakout']();
    } else if (!versionedLibrary['breakoutLoading']) {
      versionedLibrary['breakoutLoading'] = true;
      document.write('<scr' + 'ipt type="text/javascript" src="' + iframeBusterLibrary + '" async="async"></scr' + 'ipt>');
    }
  } else if (typedLibrary['bootstrap'] && creative['creativeDefinition']) {
    typedLibrary['bootstrap']();
  } else {
    if (!creative['definitionLoading']) {
      creative['definitionLoading'] = true;
      creativeDto.csiEvents['pb'] = (+new Date);
      document.write('<scr' + 'ipt type="text/javascript" src="' + creativeDto.creativeDefinitionUrl + '" async="async"></scr' + 'ipt>');
    }
    if (!typedLibrary['loading']) {
      typedLibrary['loading'] = true;
      creativeDto.csiEvents['gb'] = (+new Date);
      document.write('<scr' + 'ipt type="text/javascript" src="' + renderingLibrary + '" async="async"></scr' + 'ipt>');
    }
  }
  if (isMsnAjaxIframe) {
    window.setTimeout("document.close();", 1000);
  }
})();
