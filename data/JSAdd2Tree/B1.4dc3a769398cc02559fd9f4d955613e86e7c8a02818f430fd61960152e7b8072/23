(function() {
    var DEBUG = ''.toLowerCase() == 'true';
    var csiStart = (+new Date);
    var studioObjects = window['studioV2'] = window['studioV2'] || {};
    var publisherSideFilePath = '';
    if (publisherSideFilePath == '') {
        publisherSideFilePath = '/doubleclick/DARTIframe.html';
    } else if (publisherSideFilePath.charAt(publisherSideFilePath.length - 1) == '/') {
        publisherSideFilePath += 'DARTIframe.html';
    }
    var bookingTimeMetaData = {};
    var runtimeMetaData = {};
    var exitUrlPatternMacroValues = {};
    var macroParser = function(macroName, value) {
        return (value.indexOf(macroName) < 0) ? value : '';
    };
    var adServerData = {
        eventReportingUrl: 'https://ad.doubleclick.net/activity;src=3163378;met=1;v=1;pid=104122646;aid=277009133;ko=0;cid=56200082;rid=56089396;rv=4;',
        clickUrl: 'http://adclick.g.doubleclick.net/aclk?sa=L&ai=BTLtTYRhwUubLNo2clQeSoYCQBLW_wfQFAAAAEAEgADgAWPW70NuAAWDJvrmH4KO0EIIBF2NhLXB1Yi0yNjE0NjY2MjYxNTc5NzQxsgEPd3d3LnlvdXR1YmUuY29tugEJZ2ZwX2ltYWdlyAEJ2gEYaHR0cHM6Ly93d3cueW91dHViZS5jb20vwAIC4AIA6gIYNDA2MS9jb20ueXRob21lL19kZWZhdWx0-AL_0R6AAwGQA-ADmAPgA6gDAeAEAaAGHg&num=0&sig=AOD64_38RmsZliJSZPSFj6JAKndzf28XXA&client=ca-pub-2614666261579741&adurl=https://adclick.g.doubleclick.net/aclk?sa=L&ai=BGh3cYRhwUo-JOIuclQeh0oGoDAAAAAAQASAAOABQr7_kxf7_____AViSl-YaYMm-uYfgo7QQggEJY2EtZ29vZ2xlsgEPd3d3LnlvdXR1YmUuY29tyAEJ2gEYaHR0cHM6Ly93d3cueW91dHViZS5jb20vqAMB4AQCoAYf4AbyicEB&num=0&sig=AOD64_1iOp_HnpspAoSsqiBSUoF2ZQ1hhQ&client=&adurl=',
        clickUrlTimesToEscape: '',
        impressionUrl: '',
        geoData: 'ct=US&st=GA&city=13241&dma=26&zp=30318&bw=4',
        siteName: 'N5700.127733.4511652073321',
        siteId: '722036',
        adId: '277009133',
        buyId: '7907545',
        creativeId: '56200082',
        placementId: '104122646',
        advertiserId: '3163378',
        keyValueOrdinal: '0',
        renderingVersion: '4',
        renderingId: '56089396',
        randomNumber: '1214420979',
        dynamicData: '',
        stringReportingUrl: 'https://ad.doubleclick.net/activity;src=3163378;stragg=1;v=1;pid=104122646;aid=277009133;ko=0;cid=56200082;rid=56089396;rv=4;rn=1214420979;',
        urlToGetKeywordsFor: '%LivePreviewSiteUrl',
        bookingTimeMetaData: bookingTimeMetaData,
        exitSuffix: macroParser('exit_suffix', ''),
        generatedAdSlot: false,
        exitUrlPatternMacroValues: exitUrlPatternMacroValues,
        activeViewClkStr: macroParser('eav', ''),
        tag: {
            adContainerElementId: macroParser('ad_container_id', ''),
            hideObjects: '',
            top: '',
            left: '',
            zIndex: '',
            duration: '',
            wmode: '',
            preferHtml5Artwork: '' == 'true',
            adSenseKeywords: '',
            adSenseLatitude: '',
            adSenseLongitude: '',
            publisherSideFilePath: publisherSideFilePath,
            runtimeMetaData: runtimeMetaData,
            lidarEnabled: false,
            expansionMode: '',
            renderFloatInplace: ''.toLowerCase() == 'true'
        }
    };
    var mediaServer = location.protocol == 'https:' ?
        'https://s0.2mdn.net' :
        'http://s0.2mdn.net';
    var backupImageUrl = '/ads/richmedia/studio/25266764/25420055_20131021070318734_Youtube_Masthead_BackupImage.jpg';
    if (!/^https?:/.test(backupImageUrl)) {
        backupImageUrl = mediaServer + backupImageUrl;
    }
    var backupImage = {
        exitUrl: 'https://ad.doubleclick.net/activity;src=3163378;met=1;v=1;pid=104122646;aid=277009133;ko=0;cid=56200082;rid=56089396;rv=4;cs=s;eid1=1324885;ecn1=1;etm1=0;_dc_redir=url?http://adclick.g.doubleclick.net/aclk?sa=L&ai=BTLtTYRhwUubLNo2clQeSoYCQBLW_wfQFAAAAEAEgADgAWPW70NuAAWDJvrmH4KO0EIIBF2NhLXB1Yi0yNjE0NjY2MjYxNTc5NzQxsgEPd3d3LnlvdXR1YmUuY29tugEJZ2ZwX2ltYWdlyAEJ2gEYaHR0cHM6Ly93d3cueW91dHViZS5jb20vwAIC4AIA6gIYNDA2MS9jb20ueXRob21lL19kZWZhdWx0-AL_0R6AAwGQA-ADmAPgA6gDAeAEAaAGHg&num=0&sig=AOD64_38RmsZliJSZPSFj6JAKndzf28XXA&client=ca-pub-2614666261579741&adurl=https://adclick.g.doubleclick.net/aclk?sa=L&ai=BGh3cYRhwUo-JOIuclQeh0oGoDAAAAAAQASAAOABQr7_kxf7_____AViSl-YaYMm-uYfgo7QQggEJY2EtZ29vZ2xlsgEPd3d3LnlvdXR1YmUuY29tyAEJ2gEYaHR0cHM6Ly93d3cueW91dHViZS5jb20vqAMB4AQCoAYf4AbyicEB&num=0&sig=AOD64_1iOp_HnpspAoSsqiBSUoF2ZQ1hhQ&client=&adurl=http://www.callofduty.com/ghosts/media/gameplaylaunch',
        target: '_blank',
        imageUrl: backupImageUrl,
        width: '970',
        height: '250',
        backupDisplayActivityUrl: [
            adServerData.eventReportingUrl,
            '&timestamp=', (+new Date), ';',
            'eid1=9;ecn1=1;etm1=0;'
        ].join(''),
        thirdPartyBackupImpressionUrl: ''
    };
    var versionPrefix = DEBUG ? 'db_' : '';
    var templateVersion = '200_31';
    var renderingScriptPath = '/879366';
    var rendererDisplayType = '';
    rendererDisplayType += 'flash_';
    var rendererFormat = 'expanding';
    var rendererName = rendererDisplayType + rendererFormat;
    var renderingLibrary = renderingScriptPath + '/' + rendererName + '_rendering_lib_' +
        versionPrefix + templateVersion + '.js';
    if (!/^https?:/.test(renderingLibrary)) {
        renderingLibrary = mediaServer + renderingLibrary;
    }
    var adCreativeDefinitions = {};
    var creativeId = '1382974081239';
    var adId = adCreativeDefinitions[adServerData.adId] ? adServerData.adId : 0;
    var creativeKey = [creativeId, adId].join('_');
    var creativeDef = adCreativeDefinitions[adServerData.adId] ?
        adCreativeDefinitions[adServerData.adId] :
        'https://s0.doubleclick.net/3163378/plcr_2756816_0_1382974081642.js';
    if (!/^https?:/.test(creativeDef)) {
        creativeDef = mediaServer + creativeDef;
    }
    studioObjects['creativeCount'] = studioObjects['creativeCount'] || 0;
    var creativeDto = {
        id: creativeId,
        uniqueId: creativeId + '_' + studioObjects['creativeCount']++,
        templateVersion: templateVersion,
        adServerData: adServerData,
        isPreviewEnvironment: '%PreviewMode' == 'true',
        hasFlashAsset: true,
        hasHtmlAsset: false,
        flashVersion: '10.3',
        httpsMediaServer: 'https://s0.2mdn.net',
        httpMediaServer: 'http://s0.2mdn.net',
        renderingScriptPath: renderingScriptPath,
        renderingLibrary: renderingLibrary,
        rendererName: rendererName,
        creativeDefinitionUrl: creativeDef,
        creativeKey: creativeKey,
        thirdPartyImpressionUrls: ['https://googleads.g.doubleclick.net/pagead/viewthroughconversion/1002024250/?value\x3d0\x26label\x3d9gyeCJaimwkQutrm3QM\x26guid\x3dON\x26script\x3d0'],
        thirdPartyArtworkImpressionUrl: '',
        breakoutToTop: false,
        dimensions: {
            width: '970px',
            height: '250px'
        },
        csiStart: csiStart,
        csiAdRespTime: csiStart - (parseFloat('') || 0),
        csiEvents: {}
    };
    var inGdnIframe = window['IN_ADSENSE_IFRAME'] || false;
    var inYahooSecureIframe = window.Y && Y.SandBox && Y.SandBox.vendor;
    var inWinLiveIframe = false;
    try {
        inWinLiveIframe = !! window.$WLXRmAd;
    } catch (e) {}
    var inSafeFrame = window.$sf && window.$sf.ext;
    var isMsnAjaxIframe = (typeof(inDapMgrIf) != 'undefined' && inDapMgrIf);
    var breakoutInpage = ''.toLowerCase() == 'true';
    var shouldBreakout = (((true ||
            false) && !inGdnIframe && !inYahooSecureIframe && !inSafeFrame && !inWinLiveIframe) ||
        (false && breakoutInpage)) &&
        self != top && !creativeDto.isPreviewEnvironment;
    if (adServerData.tag.adContainerElementId == '' &&
        (false || true ||
            adServerData.tag.renderFloatInplace)) {
        var containerId = ['creative', creativeDto.uniqueId].join('_');
        var divHtml = ['<div id="', containerId, '"></div>'].join('');
        document.write(divHtml);
        adServerData.tag.adContainerElementId = containerId;
        adServerData.generatedAdSlot = true;
    }
    var creatives = studioObjects['creatives'] = studioObjects['creatives'] || {};
    var creative = creatives[creativeKey] = creatives[creativeKey] || {};
    var adResponses = creative['adResponses'] = creative['adResponses'] || [];
    creative['shouldBreakout'] = creative['shouldBreakout'] || shouldBreakout;
    var iframeBusterLibrary = renderingScriptPath + '/iframe_buster_' +
        versionPrefix + templateVersion + '.js';
    if (!/^https?:/.test(iframeBusterLibrary)) {
        iframeBusterLibrary = mediaServer + iframeBusterLibrary;
    }
    var loadedLibraries = studioObjects['loadedLibraries'] = studioObjects['loadedLibraries'] || {};
    var versionedLibrary = loadedLibraries[templateVersion] = loadedLibraries[templateVersion] || {};
    var typedLibrary = versionedLibrary[rendererName] = versionedLibrary[rendererName] || {};
    adResponses.push({
        creativeDto: creativeDto,
        backupImage: backupImage
    });
    if (shouldBreakout) {
        if (versionedLibrary['breakout']) {
            versionedLibrary['breakout']();
        } else if (!versionedLibrary['breakoutLoading']) {
            versionedLibrary['breakoutLoading'] = true;
            document.write('<scr' + 'ipt type="text/javascript" src="' + iframeBusterLibrary + '" async="async"></scr' + 'ipt>');
        }
    } else if (typedLibrary['bootstrap'] && creative['creativeDefinition']) {
        typedLibrary['bootstrap']();
    } else {
        if (!creative['definitionLoading']) {
            creative['definitionLoading'] = true;
            creativeDto.csiEvents['pb'] = (+new Date);
            document.write('<scr' + 'ipt type="text/javascript" src="' + creativeDto.creativeDefinitionUrl + '" async="async"></scr' + 'ipt>');
        }
        if (!typedLibrary['loading']) {
            typedLibrary['loading'] = true;
            creativeDto.csiEvents['gb'] = (+new Date);
            document.write('<scr' + 'ipt type="text/javascript" src="' + renderingLibrary + '" async="async"></scr' + 'ipt>');
        }
    }
    if (isMsnAjaxIframe) {
        window.setTimeout("document.close();", 1000);
    }
})();